<%!
    public static class IncidentWorkLog {
        public static final String FORM_NAME = "HPD:WorkLog";
        public static final String FIELD_REQUEST_ID = "1";
        public static final String FIELD_TYPE = "1000000170";
        public static final String FIELD_SUBMIT_DATE = "1000002134";
        public static final String FIELD_SUMMARY = "1000000000";
        public static final String FIELD_NOTES = "1000000151";
        public static final String FIELD_SUBMITTER = "1000000159";
        public static final String FIELD_SOURCE = "1000000655";  
        public static final String FIELD_INCIDENT_NUMBER = "1000000161";               
        public static final String FIELD_VIEW_ACCESS = "1000000761";
        public static final String FIELD_ATTACHMENT_1 = "1000000351";
        public static final String FIELD_ATTACHMENT_2 = "1000000352";
        public static final String FIELD_ATTACHMENT_3 = "1000000353";

        public static final String[] ATTACHMENT_FIELD_IDS = {
            FIELD_ATTACHMENT_1, FIELD_ATTACHMENT_2, FIELD_ATTACHMENT_3
        };
        public static final String[] FIELD_IDS = new String[] {
            FIELD_REQUEST_ID, FIELD_TYPE, FIELD_SUBMIT_DATE, FIELD_SUMMARY, FIELD_NOTES,
            FIELD_SUBMITTER, FIELD_SOURCE, FIELD_INCIDENT_NUMBER, FIELD_VIEW_ACCESS, FIELD_ATTACHMENT_1, FIELD_ATTACHMENT_2, FIELD_ATTACHMENT_3};

        public static IncidentWorkLog[] findByIncident(HelperContext context, String incidentnumber) {
            IncidentWorkLog[] results = new IncidentWorkLog[0];
            String qualification =
                "'"+FIELD_INCIDENT_NUMBER+"' = \""+incidentnumber+"\" AND "+
                "'"+FIELD_VIEW_ACCESS+"' = \"Public\"";

            SimpleEntry[] entries = ArsBase.find(context, FORM_NAME, qualification, FIELD_IDS);
            if (entries != null && entries.length > 0) {
                results = new IncidentWorkLog[entries.length];
                for(int i=0;i<results.length;i++) {
                    results[i] = new IncidentWorkLog(entries[i]);
                }
            }

            return results;
        }

        private SimpleEntry entry;
        private Attachment[] attachments;

        public IncidentWorkLog(SimpleEntry entry) {
            this.entry = entry;
            // Build attachments
            List<Attachment> attachments = new ArrayList<Attachment>();
            for (String fieldId : ATTACHMENT_FIELD_IDS) {
                if (!entry.getEntryFieldValue(fieldId).equals("") && entry.getEntryFieldValue(fieldId) !=  null) {
                    attachments.add(new Attachment(
                        this.FORM_NAME,
                        entry.getEntryFieldValue(FIELD_REQUEST_ID), 
                        fieldId, 
                        entry.getEntryFieldValue(fieldId)));
                }
            }
            this.attachments = attachments.toArray(new Attachment[attachments.size()]);
        }

        public String getRequestId() {return entry.getEntryFieldValue(FIELD_REQUEST_ID);}
        public String getType() {return entry.getEntryFieldValue(FIELD_TYPE);}
        public String getSource() {return entry.getEntryFieldValue(FIELD_SOURCE);}
        public String getSubmitDate() {return entry.getEntryFieldValue(FIELD_SUBMIT_DATE);}
        public String getSubmitter() {return entry.getEntryFieldValue(FIELD_SUBMITTER);}
        public String getSummary() {return entry.getEntryFieldValue(FIELD_SUMMARY);}
        public String getNotes() {return entry.getEntryFieldValue(FIELD_NOTES);}
        public Attachment[] getAttachments() {return attachments;}
    }
%>